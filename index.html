<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>학생 과제 관리</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    .task {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      border: 1px solid #ddd;
      padding: 8px;
      border-radius: 4px;
      background: #fafafa;
      margin-bottom: 4px;
    }

    .task label {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-right: 8px;
    }

    .task button {
      margin-left: 4px;
      padding: 4px 8px;
      font-size: 0.85em;
      cursor: pointer;
    }

    .toggle-btn, .clear-deleted-btn {
      font-size: 0.85em;
      padding: 4px 8px;
      margin-left: 4px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: white;
      cursor: pointer;
    }

    h3 {
      display: flex;
      align-items: center;
      gap: 8px;
    }
  </style>
</head>
<body>

<h2>학생별 과제 관리</h2>

<!-- 학생별 섹션 -->
<div id="deleted-JH">
  <h3>
    삭제된 항목
    <div style="display: flex; align-items: center;">
      <button class="toggle-btn" data-target="deleted-JH">접기</button>
      <button class="clear-deleted-btn" data-student="JH" style="display: none;">비우기</button>
    </div>
  </h3>
  <div class="task-list">
    <!-- 삭제된 항목들 표시 -->
  </div>
</div>

<div id="tasks-JH">
  <h3>JH 과제</h3>
  <button onclick="addTask('JH', 'tasks')">과제 추가</button>
  <div class="task-list"></div>
</div>

<script>
const categoryFields = {
  tasks: [
    { label: '과목', type: 'text' },
    { label: '범위', type: 'text' },
    { label: '날짜', type: 'date' }
  ]
};

// toggle-btn 클릭 시 섹션 토글 및 비우기 버튼 제어
document.querySelectorAll('.toggle-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const targetId = btn.dataset.target;
    const section = document.querySelector(`#${targetId} .task-list`);
    if (!section) return;

    const isHidden = section.style.display === 'none';
    section.style.display = isHidden ? 'block' : 'none';
    btn.textContent = isHidden ? '접기' : '펴기';

    const clearBtn = document.querySelector(`#${targetId}`).querySelector('.clear-deleted-btn');
    if (clearBtn) {
      clearBtn.style.display = isHidden ? 'inline-block' : 'none';
    }
  });
});

// 비우기 버튼 클릭 시 삭제된 항목 목록 비우기
document.querySelectorAll('.clear-deleted-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const student = btn.dataset.student;
    const section = document.querySelector(`#deleted-${student} .task-list`);
    if (section) {
      section.innerHTML = '';
      alert(`${student}의 삭제된 항목을 비웠습니다.`);
    }
  });
});

// 과제 추가 함수
function addTask(student, category) {
  const taskDiv = document.createElement('div');
  taskDiv.className = 'task';

  const taskData = {};
  const inputs = [];

  categoryFields[category].forEach(field => {
    const label = document.createElement('label');
    label.textContent = field.label + ": ";

    let input;
    if (field.type === 'select') {
      input = document.createElement('select');
      field.options.forEach(opt => {
        const option = document.createElement('option');
        option.value = opt;
        option.textContent = opt;
        input.appendChild(option);
      });
    } else {
      input = document.createElement('input');
      input.type = field.type;
    }

    label.appendChild(input);
    taskDiv.appendChild(label);
    inputs.push({ label: field.label, input });
  });

  const saveBtn = document.createElement('button');
  saveBtn.textContent = '입력';
  saveBtn.onclick = () => {
    inputs.forEach(({ label, input }) => {
      taskData[label] = input.value;
    });

    if (Object.values(taskData).some(val => !val)) {
      alert('모든 항목을 입력해주세요.');
      return;
    }

    const taskId = Date.now().toString();
    // 이 부분에 Firestore 저장 로직을 추가 가능
    alert(`저장 완료: ${JSON.stringify(taskData)}`);
    taskDiv.remove();
  };

  const cancelBtn = document.createElement('button');
  cancelBtn.textContent = '취소';
  cancelBtn.onclick = () => taskDiv.remove();

  taskDiv.appendChild(saveBtn);
  taskDiv.appendChild(cancelBtn);

  document.querySelector(`#${category}-${student} .task-list`).appendChild(taskDiv);
}
</script>

</body>
</html>
